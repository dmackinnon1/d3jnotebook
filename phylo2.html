<!DOCTYPE HTML>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script src="https://d3js.org/d3.v4.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<title>D3jNotebook - modular Phyllotaxis</title>
</head>
<style>

svg {
  display: block; 
  margin: auto ;
 }


</style>
<body>
  <h1>Phyllotaxis Spirals </h1>
  <div class="inputDiv" width ="300">
    <form>
      modulo: <input type="number" id="modInput" min="1" max="20" step="1" value="1" onchange="modChange(this)">
    </form>
    <form>
      dot size: <input type="number" id="sizeInput" min="2" max="20" step="1" value="5" onchange="sizeChange(this)">
    </form>
  </div>
  <hr>
  <svg width="600" height="600"></svg>
  <hr>  
</body>
<script>

/*
* Phyllotaxis spiral, plain.
*/

function range(n) {
  return Array.from((Array(n)).keys()) ;
};

let spacer = 200;
let total = 400;
let data = range(total);
let offset = 600/2;
let dotSize = 10;

//creating the dots
let svg = d3.select("svg");
svg.selectAll("circle")
    .data(data)
    .enter().append("circle")
      .attr("cy", function(d) { return  offset + radial(d)*xComp(philo(d))})
      .attr("cx", function(d) { return offset + radial(d)*yComp(philo(d))})
      .attr("r", function(d) { return dotSize; });

//setup of coloring based on mod selection
let modValue = 1;
let sizeValue = 5;
function colorDots() {
    let svg2 = d3.select("svg");
    svg2.selectAll("circle")
      .data(data).style("fill", function(d) {
        if (d%modValue === 0) {
        return 'black';
        } else {
          return 'grey';
        }
      }).attr("r", sizeValue);
}

//initial coloring of dots
colorDots();

//colouring of dots after mod selection change
function modChange(e) {
    modValue = e.value;
    colorDots();
};

function sizeChange(e) {
    sizeValue = e.value;
    colorDots();
};

//phylotaxis specifics

function philo(n) {
  let d = n + 1; 
  return d*Math.PI*(Math.sqrt(5) +1);
}

function xComp(t) {
  return Math.cos(t);
}

function yComp(t) {
  return Math.sin(t);
}

function radial(n) {
  let d = n + 1;
  return Math.sqrt(d*spacer);
}


</script>
</html>
